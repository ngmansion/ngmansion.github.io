<html>
	<head>
		<link rel="stylesheet" type="text/css" href="./img/css.css">
		<title>イベント命令</title>
	</head>
	<body bgcolor="skyblue">
ここでは実際に聖魔のイベントで使用される命令の一例を挙げておきます。<br/>
また、イベントには未解析部分が多く
ここに挙げているイベントの中にはパラメータが多かったり、少なかったりするので注意してください。<br/>
<b>あくまで参考程度にしておき、実際に使うときはその命令を使用している場所で確認等を行ってください。</b><br/>
また、下の方に簡易範囲増援・勝利条件変更も書いておきます。<br/><br/>
封印烈火についてですが、解析される際は4バイトを最小単位としてみると解析しやすいです。<br/>
あとは、ユニットID,座標,計算された座標,会話等々を参考にされるといいです。<br/>
<hr/>
□イベント命令系<br/><br/>
40 0A 00 00 [xx xx xx xx]：ポインタ先のイベントを読み込んで実行(ポインタ先はプリセット命令の場合もある。)<br/>
プログラムのサブルーチンのようにポインタ先の20 01 00 00(イベント終了命令)でこの位置に戻ってくる。<br/>
また、プリセット命令は色々あり、増援条件やエフェクトなど他命令とセットで使用されるものもある。<br/>
<br/>
(28 02 07 00) 20 01 00 00：イベント終了命令(ほとんどの場合28 02 07 00とセット)
<br/><br/>
40 0A 00 00 BC 9D 5B 08:進撃準備画面呼び出し<br/>
GIRLS終章2でも使用しましたが、呼び出すタイミング等気をつけましょう。<br/>
<br/>
<hr/>
□画面切り替え系<br/><br/>
20 25 [ZZ] 00：マップ変更？ZZ:ID<br/>
ステージNoはどこかで参照してください。<br/>
攻略マップ前でイベントが起こり、その後攻略マップに移動するときなどに使われると思われます。<br/>
<br/>
20 26 XX YY :画面座標移動(画面隅指定でもOK ただし中心ではない模様)<br/>
28 26 XX YY :指定した座標を中心に移動(画面隅指定は危険)<br/>
29 26 ZZ 00 :ZZのキャラクターに画面移動(画面隅は危険？)<br/>
<br/>
20 29 XX 00 :霧の濃さを調整、00で霧無し。FF FFでマップの初期値に戻す<br/>
<br/>
20 27 [XX] 00:XX番の部分マップ変更を実行<br/>
21 27 [XX] 00:XX番の部分変更を元に戻す<br/>
XXをFF FFにして直前に座標指定(40 05 0B 00 XX 00 YY 00)をしてあげれば、その座標の部分変化を起こすことができます。<br/>
<hr/>

□会話など<br/>
<br/>
20 1B XX XX 20 1D 00 00 22 1B 00 00：背景無しの通常会話(21 1Bパターンもあり)<br/>
<br/>
40 05 03 00 XX XX 00 00 40 0A 00 00 48 04 A6 08 :これも会話(背景付き用？)<br/>
<br/>
40 05 02 00 XX 00 00 00 40 0A 00 00 20 04 A6 08:XX=背景変更？<br/>
<br/>
40 0A 00 00 24 9D 5B 08 20 10 04 00 23 1A 00 00 40 05 0B 00 FF FF FF FF 20 1B [XX XX] 20 1D 00 00 22 1B 00 00<br/>
システムメッセージ:XXのシステムメッセージを表示します。(スキップできず強制的に表示されます。)<br/>
<br/>
20 12 XX 00 20 1A 00 00:BGM変更XX曲番号<br/>
20 14 XX 00 20 0E [21] 00 20 1A 00 00:会話中のBGM変更用？(使わなかったので未解析)<br/>
20 16 XX 00:XX番の効果音<br/>
<br/>
21 3B XX 00 20 0E 3C 00 22 3B 00 00：対象XXのキャラクターに[ ]枠で点滅<br/>
20 3B XX YY 20 0E 3C 00 22 3B 00 00：画面のXX,YY座標を点滅<br/>
どちらもゲーム画面内に入っていないと、変な場所を点滅したりします。
<br/><br/><hr/>

□ユニット出現・移動・消去関係<br/><br/>
40 05 0B 00 XX 00 YY 00：XX YY の座標ﾃﾞｰﾀ(ｷｬﾗｸﾀｰ)取得　後ろの命令に使う命令用?(座標移動にも使う？)<br/>
主にIDで取得できない雑魚兵や特殊な場合のユニット取得につかわれると思います。<br/>
移動系命令の直前などに使われ、ユニットIDにはFF等を使用していると思われます。<br/>
<b>また、イベント等で敵を出現させるときは50体制限に注意しましょう。</b><br/>
50体制限で出現できずにいるユニットをイベントで指定すると、フリーズします。<br/>
<br/>
○ユニット出現<br/>
40 2C 01 00 [XX XX XX XX] 20 30 00 00：アドレスからユニット情報をよみこみ移動させる。主にイベント用<br/>
40 05 02 00 [XX XX XX XX] 40 0A 00 00 <b>AC 03 A6 08</b>：アドレスからユニット情報をよみこみ移動させる。主に増援用<br/>
40 05 02 00 [XX XX XX XX] 40 0A 00 00 <b>D4 03 A6 08</b>：ハード限定で出現。主に増援用<br/>
・以下の用に各イベントを書き換えればハード用増援をノーマルでも出現させることができます。<br/>
　D4 03 A6 08=>AC 03 A6 08<br/><br/>
※ポインタを使用せずにユニットIDだけを入れると、持ち物無しの、キャラクター設定のデータのユニットが出現します。<br/>
　このユニットはイベントで現れ会話後すぐ消える様な場合にだけに使うとよいでしょう。<br/>


<br/><br/>
○ユニット移動<br/>
※キャラクター指定が[FE FF]やない場合や雑魚兵などは直前の40 05 0B 00命令の座標にいるユニットを指定する。<br/><br/>
40 2F FF FF ZZ 00 XX YY：ZZをXX,YYに移動(FF FF速度？)<br/>
40 2F 10 00 ZZ 00 XX YY：ZZをXX,YYに移動(10 00速度？)<br/>
41 2F 00 00 ZZ 00 WW 00：ZZをWWのキャラまで移動	<br/>
20 30 00 00：移動開始命令？上記移動命令系の最後に付いて、前にある移動命令を同時に実行させる。必ず必要。<br/>
<br/>
※雑魚用は40 05 0B 00命令を直前に使用<br/>
40 05 0B 00 [XX] 00 [YY] 00 40 2F 18 00 FE FF [XX2] [YY2] 20 30 00 00：XX,YYのユニットをXX2,YY2に移動<br/>
また、同じ名前の雑魚でもイベントのためだけにユニットIDが違うものがいますが、これは主に移動用のためです。<br/>
<br/>

42 2F ZZ 00 XX 00 YY 00：1マス移動系　XXがYY方向(00:← 01:→ 02:↓ 03↑) ZZ:速度?で1マス移動<br/>
<br/>
○消去<br/>
2F 34 ZZ 00:ZZのユニットを消去<br/>
40 05 0B 00 [XX] 00 [YY] 00 2F 34 FE FF:XX YY のキャラ消去<br/>
<hr/>
□ユニット関係の特殊系<br/>
40 05 02 00 [ZZ] 00 00 00 48 2F FF FF FD FF [XX] [YY] 40 0A 00 00 30 06 A6 08<br/>
ZZのキャラクターをXX,YYにワープエフェクトで出現<br/>
40 05 02 00 [ZZ] 00 00 00 40 0A 00 00 54 06 A6 08 2F 34 [ZZ] 00<br/>
上記のワープで出現したユニットをワープで消去<br/>
<br/>
40 05 01 00 [XX] [YY] 00 00 20 39 [ZZ] 00 :ZZのユニットのAIをXX YYに変更<br/>
ZZは全部のユニット(ZZの雑魚全部)が対象になります。<br/>
<br/>
イベント戦闘<br/>
40 3F [XX] 00 [YY] 00 [ZZ] 00 21 02 01 00：XXがYYに攻撃 ZZ武器固定<br/>
41 3F....(強制マップ戦闘)<br/>
2D 34 [ZZ] 00 2E 34 [ZZ] 00：ZZのユニットを死亡エフェクト消去(ZZをFE FFで直前座標指定可能)<br/>
<br/>

所属変更<br/>
22 34 XX 00:XXのキャラクターを自軍に<br/>
23 34 XX 00:XXのキャラクターを友軍に<br/>
24 34 XX 00:XXのキャラクターを敵軍に<br/>
<hr/>
□アイテム関係<br/><br/>
40 05 03 00 [XX] 00 00 00 20 37 FF FF XXのアイテム入手 <br/>
40 05 03 00 [XX XX] 00 00 21 37 00 00 ゴールド入手<br/>
<hr/>
□範囲条件関係<br/><br/>
40 05 02 00 [XX] 00 00 00 40 0A 00 00 <b>D4 02 A6 08</b>：XXのキャラクターが範囲に停止したら。<br/>
40 05 02 00 00 00 00 00 40 0A 00 00 <b>F0 02 A6 08</b>：自軍なら誰が通過しても<br/>
※範囲条件(0B)のイベント先の先頭に設置しないと、敵が侵入してもイベントが実行されてしまう。
<hr/>
□フラグ系<br/><br/>
29 02 [XX] 00:特殊フラグ準備とオフ(章開始時の初期化に使用？)<br/>
21 02 [XX] 00:フラグオン(章OPで初期化していないとダメ？)<br/>
※フラグ関係はまだわからないところがいくつもあります。<br/>
<hr/>
<h3>簡易範囲増援</h3>
ここでは、指定範囲に入った際に1度だけ増援する方法を書いておきます。<br/>
何ターン続けてなどは常時条件(01)やイベント内でカウント・条件など複雑になっています。<br/>
自分でもまだ、解析しきれていないので、今回は簡易なやり方だけ載せておきます。<br/>
まず、使用していないフラグを必ず調べましょう。<br/>
フラグは、ターン条件、範囲条件、会話条件、ボス戦闘条件とあり、<br/>
どれも被らないように設計されています。<br/>
調べるのが面倒なら20～あたりから使用してみてください。<br/>
また範囲に止まったときにオンになるフラグは範囲に止まる度にオンになるので、<br/>
02ターン条件の1-255の増援が永遠沸いてしまいます。<br/>
なので0Bの範囲の方に「0B 00 XX 00」のXXに入れるフラグの２つ必要になってきます。。<br/>
<br/>
○各章オープニングでターン条件に必要なフラグの初期化？が必要<br/>
29 02 [XX] 00：章で使用するフラグを準備する。<br/>
例「29 02 0D 00」0Dフラグを準備する。<br/>
空き領域に章開始イベントを移し(ポインタ移動も必要)、章開始イベントの終了際28 02 07 00 20 01 00 00に<br/>
追加しましょう。これはターン条件の方のフラグのみで結構です。<br/>

<br/>
○増援条件<br/>
ターン条件<br/>
02 00 [XX] 00 [イベントポインタ] 01 FF 00 00 ：XXフラグがオンの時01～FF(∞？)まで<br/>
(全ターンなのは範囲条件を満たしたときいつでもイベントを起こせるように)<br/>
例「02 00 0D 00 [増援イベント] 01 FF 00 00」<br/>
ターン条件0Dフラグがオンの時01～FFまで増援を出す。<br/>
<br/>
○範囲指定<br/>
0B 00 [XX] 00 [イベントポインタ] 00 00 13 0B ：<br/>
範囲を満たし[XX]フラグを使用してイベント実行<br/>
例「0B 00 0E 00 [イベントポインタ] 00 00 13 0B」<br/>
00,00～13,0Bの範囲にいるときに、0Eフラグを使用して、一度イベント実行<br/>
0Dフラグをオンにするのは範囲指定のイベント(次項)で実行。<br/>
<br/>
○範囲指定のイベント内容<br/>
40 05 02 00 [XX] 00 00 00 40 0A 00 00 <D4 02 A6 08> ：XXのキャラクターが範囲に停止したら。<br/>
40 05 02 00 <00> 00 00 00 40 0A 00 00 <F0 02 A6 08> ：自軍なら誰が通過しても<br/>
21 02 [XX] 00：XXのフラグをオン？<br/>
例「40 05 02 00 [01] 00 00 00 40 0A 00 00 D4 02 A6 08 21 02 [0D] 00 28 02 07 00 20 01 00 00」<br/>
範囲条件を満たし、エイリークだった場合、0Dフラグ(章OPで要初期化)をオンにする。<br/>
<hr/>
<h3>クリア条件変更</h3>
[範囲/常時条件]01 00 03 00 [クリアイベント] 06 00 00 00：敵全滅<br/>
[範囲/常時条件]01 00 03 00 [クリアイベント] 02 00 00 00：ボス撃破	<br/>
[オブジェクト条件]05 00 03 00 [01 00 00 00] [XX] [YY] 11 00：玉座制圧	<br/>
<br/>
・他の条件から玉座に変えるときは、[01 00 00 00]が終了イベントを実行してくれるので、イベントポインタは特に不要になります。<br/>
※また敵全滅から玉座制圧に変えるときは、ターン条件の全滅の判定の方のポインタの方も消さないといけません。<br/>
02 00 [00] 00 [A0 A2 A6 08] 01 FF 00 00<br/>
このように01～FFの上に条件が無い(フラグが[00])のが毎ターン敵全滅の判定をしているようです。<br/>
[A0 A2 A6 08]を00で埋めればとりあえずは大丈夫です。<br/>
<br/>
・玉座から敵全滅等は「章開始イベントと終了時のイベントポインタの位置」を探してそれをクリアイベントとする。<br/>
<br/>
・防衛にするときは02フラグのターンの方で、最終ターン条件のイベントをクリアイベントにすればいいだけです。<br/>
<br/>
		<hr/>
	</body>
</html>